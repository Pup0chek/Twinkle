<!DOCTYPE html>
<html>
<head>
    <title>Congrads!</title>
    <meta charset="utf-8" />
</head>
<body>
     <p>
        Поздравляю с регистрацией!
    </p>
     <button onclick="send1()">Составить план диеты</button>
     <button onclick="send2()">Составить план тренировок</button>
</body>
<script>
    async function sendRequest(endpoint) {
    // Формируем запрос
    const response = await fetch(`${endpoint}?token=${encodeURIComponent(localStorage.getItem("access_token"))}`, {
        method: "GET",
        headers: { "Accept": "application/json", "Content-Type": "application/json" },
    });

    // Проверяем, успешен ли ответ
    if (response.ok) {
        // Проверяем, является ли ответ JSON
        if (response.headers.get("Content-Type")?.includes("application/json")) {
            const data = await response.json();
            // Сохраняем новый токен, если он присутствует в ответе
            if (data.access_token) {
                localStorage.setItem("access_token", data.access_token);
            }
            // Перенаправляем на страницу в зависимости от запроса
            if (endpoint === "/params") {
                window.location.href = `/params?token=${encodeURIComponent(data.access_token || localStorage.getItem("access_token"))}`;
            } else if (endpoint === "/train") {
                window.location.href = `/train?token=${encodeURIComponent(data.access_token || localStorage.getItem("access_token"))}`;
            }
        } else {
            // Если ответ не JSON, выполняем редирект с токеном из localStorage
            window.location.href = `${endpoint}?token=${encodeURIComponent(localStorage.getItem("access_token"))}`;
        }
    } else {
        // Логируем ошибки в консоль
        console.log(`Ошибка при запросе к ${endpoint}:`, response);
    }
}

// Функции send1 и send2, которые вызывают sendRequest с нужным endpoint
function send1() {
    sendRequest("/params");
}

function send2() {
    sendRequest("/train");
}

</script>
</html>